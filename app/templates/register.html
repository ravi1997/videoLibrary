{% extends "layout.html" %}
{% block title %}Register Â· RPC Surgical Video Library{% endblock %}

{% block head_extra %}
<style>
    /* small polished helpers copied from login styles */
    input.input:-webkit-autofill,
    input.input:-webkit-autofill:hover,
    input.input:-webkit-autofill:focus {
        -webkit-text-fill-color: var(--text);
        transition: background-color 5000s ease-in-out 0s;
        box-shadow: 0 0 0px 1000px color-mix(in oklab, var(--surface) 96%, transparent) inset;
    }

    .fl-label { transition: transform .18s ease, color .18s ease, top .18s ease, font-size .18s ease; }
    .elevated { box-shadow: 0 10px 30px rgba(0,0,0,.08), 0 2px 10px rgba(0,0,0,.04); border: 1px solid color-mix(in oklab, var(--border) 85%, transparent); }
    .icon-chip { width:42px;height:42px;border-radius:14px;display:grid;place-items:center;background:linear-gradient(180deg,var(--brand-500),var(--brand-600));color:#fff; }
    /* Password strength progress styling */
    progress#pwStrength { appearance: none; -webkit-appearance: none; height: 8px; border-radius: 999px; overflow: hidden; background: #e6e6e6; }
    progress#pwStrength::-webkit-progress-bar { background: transparent; }
    progress#pwStrength::-webkit-progress-value { background: linear-gradient(90deg,#ff6b6b,#ffd166,#06d6a0,#4cc9f0); }
    progress#pwStrength.strength-0::-webkit-progress-value { background: #e6e6e6; }
    progress#pwStrength.strength-1::-webkit-progress-value { background: #ff6b6b; }
    progress#pwStrength.strength-2::-webkit-progress-value { background: #ffb86b; }
    progress#pwStrength.strength-3::-webkit-progress-value { background: #06d6a0; }
    progress#pwStrength.strength-4::-webkit-progress-value { background: #4cc9f0; }
    /* make the error region focusable for assistive tech */
    #reg_error[role="alert"]{ outline: none; }
</style>
{% endblock %}

{% block content %}
<!-- Ambient background (mirrors login) -->
<div class="pointer-events-none fixed inset-0 -z-10">
    <div class="absolute inset-0 opacity-70 dark:opacity-40" style="background:
             radial-gradient(900px 480px at 15% -10%, color-mix(in oklab, var(--brand-600) 18%, transparent) 0%, transparent 60%),
             radial-gradient(900px 520px at 110% 0%, color-mix(in oklab, var(--brand-400) 18%, transparent) 0%, transparent 62%),
             linear-gradient(180deg, color-mix(in oklab, var(--surface) 98%, transparent) 0%, transparent 100%);"></div>
</div>

<section class="login-grid mx-auto max-w-6xl px-4 md:px-8 py-6 items-center justify-center content-center md:py-7 grid md:grid-cols-2 gap-8">
    <!-- Hero / Brand side -->
    <div class="flex flex-col py-2 items-center md:items-start text-center md:text-left space-y-10">
        <div class="w-full">
            <!-- Inline SVG copied from login page for consistent branding -->
            <svg viewBox="0 0 350 304.39084543302795" preserveAspectRatio="xMidYMid meet"
                class="mx-auto md:mx-0 w-auto h-56 md:h-80 drop-shadow-sm text-[color:var(--text)] fill-current" id="aheacbdb">
                <defs id="SvgjsDefs3127">
                    <linearGradient id="SvgjsLinearGradient3136">
                        <stop id="SvgjsStop3137" stop-color="#51504f" offset="0"></stop>
                        <stop id="SvgjsStop3138" stop-color="#939598" offset="0.5"></stop>
                        <stop id="SvgjsStop3139" stop-color="#51504f" offset="1"></stop>
                    </linearGradient>
                    <linearGradient id="SvgjsLinearGradient3140">
                        <stop id="SvgjsStop3141" stop-color="#51504f" offset="0"></stop>
                        <stop id="SvgjsStop3142" stop-color="#939598" offset="0.5"></stop>
                        <stop id="SvgjsStop3143" stop-color="#51504f" offset="1"></stop>
                    </linearGradient>
                    <linearGradient id="SvgjsLinearGradient3144">
                        <stop id="SvgjsStop3145" stop-color="#51504f" offset="0"></stop>
                        <stop id="SvgjsStop3146" stop-color="#939598" offset="0.5"></stop>
                        <stop id="SvgjsStop3147" stop-color="#51504f" offset="1"></stop>
                    </linearGradient>
                    <linearGradient id="SvgjsLinearGradient3148">
                        <stop id="SvgjsStop3149" stop-color="#51504f" offset="0"></stop>
                        <stop id="SvgjsStop3150" stop-color="#939598" offset="0.5"></stop>
                        <stop id="SvgjsStop3151" stop-color="#51504f" offset="1"></stop>
                    </linearGradient>
                </defs>
                <g id="SvgjsG3128" featurekey="symbolFeature-0"
                    transform="matrix(0.3235941529273987,0,0,0.3235941529273987,92.46748068939594,-5.177506436868018)"
                    class="fill-current">
                    <desc xmlns="http://www.w3.org/2000/svg">Surgery icon for website, application, printing, document,
                        poster
                        design, etc.</desc>
                    <metadata xmlns="http://www.w3.org/2000/svg">
                        <!--?xpacket begin="&;" id="W5M0MpCehiHzreSzNTczkc9d"?-->
                        <x:xmpmeta xmlns:x="adobe:ns:meta/"
                            x:xmptk="Adobe XMP Core 5.6-c145 79.162955, 2018/05/10-01:07:16        "></x:xmpmeta>
                        <!--?xpacket end="w"?-->
                    </metadata>
                    <g xmlns="http://www.w3.org/2000/svg">
                        <path d="M284,128a12,12,0,1,0-12-12A12.013,12.013,0,0,0,284,128Z"></path>
                        <path d="M340,128a12,12,0,1,0-12-12A12.013,12.013,0,0,0,340,128Z"></path>
                        <path
                            d="M112,336H88a8,8,0,0,0-8,8v96a24,24,0,0,0,48,0V393.252a59.324,59.324,0,0,0-7.377-50.74l-1.967-2.95A8,8,0,0,0,112,336Zm.411,53.47A8,8,0,0,0,112,392v48a8,8,0,0,1-16,0V352h11.712A43.435,43.435,0,0,1,112.411,389.47Z">
                        </path>
                        <path
                            d="M144,440a23.984,23.984,0,0,0,40,17.869,23.994,23.994,0,1,0,22.021-41.1L192.433,376l7.156-21.47A8,8,0,0,0,200,352V336H168v16a8,8,0,0,0,.411,2.53L175.567,376l-13.588,40.766A24.042,24.042,0,0,0,144,440Zm24,8a8,8,0,1,1,8-8A8.009,8.009,0,0,1,168,448Zm32,0a8,8,0,1,1,8-8A8.009,8.009,0,0,1,200,448Zm-10.321-29.664A24.1,24.1,0,0,0,184,422.131a24.1,24.1,0,0,0-5.679-3.795L184,401.3Z">
                        </path>
                        <path
                            d="M242.343,386.343A8,8,0,0,0,240,392v64a8,8,0,0,0,8,8h32a8,8,0,0,0,8-8V440H272v8H256V395.313l8-8,10.343,10.344,11.314-11.314L272,372.686V352a8,8,0,0,0-4.422-7.155l-16-8-7.156,14.31L256,356.944v15.742Z">
                        </path>
                        <path
                            d="M416.516,257.833l-49.739-7.65a7.951,7.951,0,0,1-6.777-7.9V215.189c1.375-1.16,2.721-2.361,4.011-3.632A65.64,65.64,0,0,0,384,164.565V146.216l16.02-26.7A56.02,56.02,0,0,0,408,90.705,74.79,74.79,0,0,0,333.3,16h-42.59A74.837,74.837,0,0,0,255.2,24.964l7.615,14.072A58.78,58.78,0,0,1,290.705,32H333.3A58.772,58.772,0,0,1,392,90.705a40.006,40.006,0,0,1-5.7,20.579l-2.3,3.833V112a39.92,39.92,0,0,0-14.175-30.511l11.832-11.832L370.343,58.343,355.106,73.581A39.856,39.856,0,0,0,344,72h-3.056l10.211-20.422-14.31-7.156L323.056,72h-20.81l-6.485-25.94-15.522,3.88L285.754,72H280a39.856,39.856,0,0,0-11.106,1.581L253.657,58.343,242.343,69.657l11.832,11.832A39.92,39.92,0,0,0,240,112v3.117l-2.3-3.833A40.006,40.006,0,0,1,232,90.705a58.591,58.591,0,0,1,21.125-45.1l-10.25-12.286A74.548,74.548,0,0,0,216,90.705a56.02,56.02,0,0,0,7.98,28.812l16.02,26.7v18.349a65.64,65.64,0,0,0,19.989,46.992c1.29,1.271,2.636,2.472,4.011,3.632V242.28a7.951,7.951,0,0,1-6.776,7.9l-49.74,7.65a55.668,55.668,0,0,0-36.561,22.119l12.876,9.5a39.767,39.767,0,0,1,26.118-15.8l45.191-6.95a127.771,127.771,0,0,0,113.784,0l45.192,6.95A39.78,39.78,0,0,1,448,313.18V460.687l-42.343-42.344L400,412.686V344H384v52.686l-34.343-34.343A8,8,0,0,0,344,360H320V336a32.036,32.036,0,0,0-32-32H80a32.036,32.036,0,0,0-32,32V464a32.036,32.036,0,0,0,32,32H288a32.036,32.036,0,0,0,32-32V448H304v16a16.019,16.019,0,0,1-16,16H80a16.019,16.019,0,0,1-16-16V336a16.019,16.019,0,0,1,16-16H288a16.019,16.019,0,0,1,16,16v24h-8a8,8,0,0,0-8,8v56a8,8,0,0,0,8,8h35.471l21.217,35.363,7.723,23.167,15.178-5.06-6.436-19.309L400,435.313l50.343,50.344A8,8,0,0,0,464,480V313.18A55.693,55.693,0,0,0,416.516,257.833ZM262.394,188.542c13.707,1.045,27.471,1.667,41.091,1.845l.209-16c-15.613-.205-31.422-1.005-47.106-2.375a47.694,47.694,0,0,1-.588-7.449V152.877a545.319,545.319,0,0,0,112,0v11.688a47.671,47.671,0,0,1-.588,7.448c-15.255,1.333-30.639,2.129-45.84,2.358l.241,16c13.195-.2,26.524-.816,39.793-1.828-.554.042-3.142,4.889-3.649,5.564a53.391,53.391,0,0,1-4.972,5.715,55.125,55.125,0,0,1-12.244,9.189c-9.662,5.341-20.91,7.266-31.864,6.965A55.2,55.2,0,0,1,262.394,188.542ZM344,88a24.028,24.028,0,0,1,24,24v24.79l-1.285.134a529,529,0,0,1-109.43,0L256,136.79V112a24.028,24.028,0,0,1,24-24ZM274.519,257.587A23.931,23.931,0,0,0,280,242.28V225.361a72.62,72.62,0,0,0,28.439,6.607A88.68,88.68,0,0,0,326.5,230.85c1.909-.341,17.5-3.475,17.5-5.489V242.28a23.933,23.933,0,0,0,5.481,15.307A111.905,111.905,0,0,1,274.519,257.587ZM361.588,451.1,342.86,419.884A8,8,0,0,0,336,416H304V376h36.686l48,48Z">
                        </path>
                        <path
                            d="M323.667,302.333l.215,8c1.093-.029,27.051-.9,53.207-16.454l-8.178-13.752a106.119,106.119,0,0,1-45.478,14.213Z">
                        </path>
                    </g>
                </g>
                <g id="SvgjsG3129" featurekey="nameFeature-0"
                    transform="matrix(0.8967919945716858,0,0,0.8967919945716858,-1.7935839588336449,162.2296841288588)"
                    class="fill-current">
                    <path
                        d="M2.52 40 c-0.32 0 -0.52 -0.24 -0.52 -0.52 l0 -23.96 c0 -0.28 0.2 -0.52 0.52 -0.52 l9.76 0 c3.04 0 5.44 0.76 7.12 2.32 c2.48 2.24 3.32 6.48 2.12 9.6 c-0.44 1.12 -1.2 2.16 -2.16 2.92 c-0.56 0.44 -1.16 0.76 -1.76 1.08 c1.72 2.72 4.32 8.24 4.32 8.24 c0.04 0.08 0.12 0.2 0.12 0.32 c0 0.28 -0.24 0.52 -0.52 0.52 l-5.92 0 c-0.16 0 -0.36 -0.12 -0.44 -0.28 l-3.48 -7.64 c-1.24 0.08 -2.2 0.04 -3.48 0.04 l0 7.36 c0 0.28 -0.24 0.52 -0.52 0.52 l-5.16 0 z M8.2 26.560000000000002 c0 0 5.04 0.56 6.8 -0.6 c0.68 -0.44 1.08 -1.52 1.08 -2.32 c-0.04 -0.88 -0.48 -1.8 -1.2 -2.36 c-0.76 -0.64 -2.64 -0.84 -3.6 -0.84 l-3.08 0.08 l0 6.04 z M26.560000000000002 40 c-0.28 0 -0.48 -0.24 -0.48 -0.52 l0 -23.96 c0 -0.28 0.2 -0.52 0.48 -0.52 l9.8 0 c3.04 0 5.44 0.76 7.12 2.32 c2.48 2.24 3.32 6.48 2.12 9.6 c-0.44 1.12 -1.2 2.16 -2.16 2.92 c-3.24 2.52 -7.28 2.28 -11.16 2.28 l0 7.36 c0 0.28 -0.24 0.52 -0.52 0.52 l-5.2 0 z M32.28 26.560000000000002 c0 0 5.04 0.56 6.8 -0.6 c0.68 -0.44 1.08 -1.52 1.08 -2.32 c-0.04 -0.88 -0.48 -1.8 -1.2 -2.36 c-0.76 -0.64 -2.64 -0.84 -3.6 -0.84 l-3.08 0.08 l0 6.04 z M62.800000000000004 40 c-2.36 0 -4.52 -0.56 -6.44 -1.68 c-1.92 -1.16 -3.44 -2.72 -4.52 -4.68 s-1.64 -4.16 -1.64 -6.6 c0 -2.36 0.56 -4.56 1.68 -6.52 c1.12 -1.92 2.68 -3.48 4.6 -4.6 c1.96 -1.12 4.16 -1.68 6.48 -1.68 c1.76 0 3.48 0.4 5.16 1.12 c1.68 0.76 3.12 1.76 4.32 3.04 c0.16 0.2 0.16 0.48 0 0.68 l-3.8 3.12 c-0.12 0.12 -0.24 0.2 -0.4 0.2 s-0.32 -0.08 -0.4 -0.2 c-2.04 -2.48 -5.32 -3 -8.08 -1.28 c-2.4 1.48 -3.28 4.2 -3.16 6.92 c0.12 2.76 2.12 5.12 4.76 5.92 c2.4 0.72 4.76 0.16 6.48 -1.68 c0.12 -0.08 0.24 -0.16 0.4 -0.12 c0.16 0 0.28 0.04 0.36 0.16 l3.88 2.72 c0.16 0.2 0.16 0.48 0 0.68 c-1.28 1.36 -2.8 2.48 -4.48 3.28 c-1.72 0.8 -3.48 1.2 -5.2 1.2 z M98.08000000000001 40.24 c-1.92 0 -3.84 -0.36 -5.68 -1.08 c-1.84 -0.68 -3.48 -1.68 -4.84 -2.88 c-0.16 -0.16 -0.2 -0.4 -0.12 -0.6 l1.4 -4.76 c0.08 -0.16 0.2 -0.28 0.36 -0.28 c0.16 -0.04 0.32 0 0.44 0.12 c2.12 2 4.52 3.8 7.52 3.96 c0.8 0.04 1.68 0.08 2.44 -0.16 c2.36 -0.76 1.36 -3.16 -0.4 -3.88 c-0.6 -0.24 -1.44 -0.52 -2.52 -0.84 c-1.6 -0.44 -2.92 -0.92 -3.92 -1.4 c-1.08 -0.48 -2 -1.24 -2.8 -2.24 c-0.76 -1.04 -1.16 -2.4 -1.16 -4.04 c0 -1.56 0.4 -2.92 1.2 -4.08 s1.92 -2.08 3.32 -2.68 s3.04 -0.92 4.88 -0.92 c1.64 0 3.24 0.24 4.84 0.76 c1.56 0.48 2.96 1.16 4.2 1.96 c0.2 0.16 0.28 0.4 0.16 0.64 l-1.32 4.48 c-0.04 0.16 -0.16 0.24 -0.32 0.28 c-0.12 0.04 -0.28 0.04 -0.4 -0.04 c-1.8 -1.12 -3.6 -2.48 -5.72 -2.76 c-1.4 -0.2 -3.52 -0.12 -4 1.56 c-0.6 2.16 2.56 2.72 4 3.16 c1.6 0.48 2.92 0.96 3.96 1.44 c1.08 0.52 2.04 1.32 2.8 2.32 c0.8 1.04 1.2 2.44 1.2 4.12 c0 1.64 -0.44 3.04 -1.28 4.24 c-0.8 1.2 -1.96 2.08 -3.4 2.72 c-1.44 0.56 -3.04 0.88 -4.84 0.88 z M122.04 40 c-2.16 0 -3.72 -0.44 -5.36 -1.32 c-1.6 -0.88 -2.88 -2.12 -3.76 -3.76 c-0.88 -1.6 -1.32 -3.52 -1.32 -5.72 l0 -14.08 c0 -0.28 0.24 -0.48 0.52 -0.48 l5.2 0 c0.28 0 0.48 0.2 0.48 0.48 l0 14.08 c0 1.6 0.44 2.84 1.28 3.72 s1.6 1.32 3 1.32 s2.12 -0.44 2.92 -1.28 c0.8 -0.88 1.2 -2.16 1.2 -3.76 l0 -14.08 c0 -0.28 0.24 -0.48 0.52 -0.48 l5.2 0 c0.28 0 0.52 0.2 0.52 0.48 l0 14.08 c0 2.2 -0.44 4.12 -1.32 5.72 c-0.84 1.64 -2.12 2.88 -3.72 3.76 s-3.2 1.32 -5.36 1.32 z M136.96 40 c-0.32 0 -0.52 -0.24 -0.52 -0.52 l0 -23.96 c0 -0.28 0.2 -0.52 0.52 -0.52 l9.76 0 c3.04 0 5.44 0.76 7.12 2.32 c2.48 2.24 3.32 6.48 2.12 9.6 c-0.44 1.12 -1.2 2.16 -2.16 2.92 c-0.56 0.44 -1.16 0.76 -1.76 1.08 c1.72 2.72 4.32 8.24 4.32 8.24 c0.04 0.08 0.12 0.2 0.12 0.32 c0 0.28 -0.24 0.52 -0.52 0.52 l-5.92 0 c-0.16 0 -0.36 -0.12 -0.44 -0.28 l-3.48 -7.64 c-1.24 0.08 -2.2 0.04 -3.48 0.04 l0 7.36 c0 0.28 -0.24 0.52 -0.52 0.52 l-5.16 0 z M142.64 26.560000000000002 c0 0 5.04 0.56 6.8 -0.6 c0.68 -0.44 1.08 -1.52 1.08 -2.32 c-0.04 -0.88 -0.48 -1.8 -1.2 -2.36 c-0.76 -0.64 -2.64 -0.84 -3.6 -0.84 l-3.08 0.08 l0 6.04 z M173.28 40 c-2.36 0 -4.56 -0.56 -6.48 -1.68 c-1.96 -1.16 -3.48 -2.72 -4.6 -4.64 c-1.12 -1.96 -1.68 -4.2 -1.68 -6.6 s0.56 -4.6 1.72 -6.52 c1.12 -1.96 2.72 -3.52 4.68 -4.64 c2 -1.12 4.24 -1.68 6.68 -1.68 c1.76 0 3.48 0.32 5.2 1 c1.68 0.64 3.16 1.56 4.36 2.72 c0.2 0.16 0.24 0.44 0.08 0.68 l-2.92 3.84 c-0.12 0.12 -0.24 0.2 -0.4 0.24 c-0.12 0 -0.28 -0.08 -0.4 -0.16 c-0.8 -0.8 -1.72 -1.44 -2.8 -1.88 c-1.04 -0.44 -2.08 -0.68 -3.12 -0.68 c-1.24 0 -2.4 0.32 -3.4 0.92 c-1.04 0.64 -1.84 1.48 -2.44 2.56 s-0.88 2.28 -0.88 3.6 s0.28 2.56 0.88 3.64 s1.44 1.96 2.44 2.6 c1.04 0.6 2.2 0.92 3.4 0.92 c0.64 0 1.32 -0.12 2.08 -0.32 c0.64 -0.2 1.32 -0.48 1.92 -0.8 l0 -1.84 l-2.76 0 c-0.16 0 -0.28 -0.04 -0.36 -0.16 c-0.12 -0.08 -0.16 -0.2 -0.16 -0.36 l0.04 -4.48 c0 -0.28 0.24 -0.52 0.52 -0.52 l7.76 0 c0.28 0 0.52 0.24 0.52 0.52 l0 10.04 c0 0.16 -0.08 0.32 -0.24 0.44 c-1.24 0.96 -2.76 1.76 -4.52 2.32 c-1.76 0.6 -3.48 0.92 -5.12 0.92 z M187.84000000000003 40 c-0.28 0 -0.52 -0.24 -0.52 -0.52 l0 -23.96 c0 -0.28 0.24 -0.52 0.52 -0.52 l5.2 0 c0.28 0 0.52 0.24 0.52 0.52 l0 23.96 c0 0.28 -0.24 0.52 -0.52 0.52 l-5.2 0 z M210.16000000000003 40 c-2.36 0 -4.52 -0.56 -6.44 -1.68 c-1.92 -1.16 -3.44 -2.72 -4.52 -4.68 s-1.64 -4.16 -1.64 -6.6 c0 -2.36 0.56 -4.56 1.68 -6.52 c1.12 -1.92 2.68 -3.48 4.6 -4.6 c1.96 -1.12 4.16 -1.68 6.48 -1.68 c1.76 0 3.48 0.4 5.16 1.12 c1.68 0.76 3.12 1.76 4.32 3.04 c0.16 0.2 0.16 0.48 0 0.68 l-3.8 3.12 c-0.12 0.12 -0.24 0.2 -0.4 0.2 s-0.32 -0.08 -0.4 -0.2 c-2.04 -2.48 -5.32 -3 -8.08 -1.28 c-2.4 1.48 -3.28 4.2 -3.16 6.92 c0.12 2.76 2.12 5.12 4.76 5.92 c2.4 0.72 4.76 0.16 6.48 -1.68 c0.12 -0.08 0.24 -0.16 0.4 -0.12 c0.16 0 0.28 0.04 0.36 0.16 l3.88 2.72 c0.16 0.2 0.16 0.48 0 0.68 c-1.28 1.36 -2.8 2.48 -4.48 3.28 c-1.72 0.8 -3.48 1.2 -5.2 1.2 z M222.48000000000005 40 c-0.16 0 -0.32 -0.08 -0.4 -0.24 c-0.12 -0.12 -0.12 -0.32 -0.08 -0.48 l9.32 -23.96 c0.08 -0.2 0.28 -0.32 0.48 -0.32 l5.36 0 c0.2 0 0.4 0.12 0.48 0.32 l9.16 23.96 c0.04 0.16 0.04 0.32 -0.08 0.48 c-0.08 0.16 -0.24 0.24 -0.4 0.24 l-5.56 0 c-0.2 0 -0.4 -0.12 -0.48 -0.32 l-1.48 -3.68 l-9 0.04 l-1.48 3.64 c-0.08 0.2 -0.28 0.32 -0.48 0.32 l-5.36 0 z M231.44000000000003 31 l5.76 0 l-2.88 -8.48 z M250.96000000000004 40 c-0.28 0 -0.52 -0.24 -0.52 -0.52 l0 -23.96 c0 -0.28 0.24 -0.52 0.52 -0.52 l5.2 0 c0.28 0 0.52 0.24 0.52 0.52 l0 18.72 l9 0 c0.28 0 0.52 0.24 0.52 0.52 l0 4.72 c0 0.28 -0.24 0.52 -0.52 0.52 l-14.72 0 z M289.52000000000004 40 c-0.2 0 -0.4 -0.12 -0.48 -0.32 l-8 -24 c-0.08 -0.16 -0.04 -0.32 0.04 -0.48 c0.12 -0.12 0.28 -0.2 0.44 -0.2 l5.6 0 c0.2 0 0.4 0.12 0.48 0.36 l4.76 15.64 l4.8 -15.64 c0.08 -0.24 0.28 -0.36 0.48 -0.36 l5.36 0 c0.16 0 0.32 0.08 0.44 0.2 c0.08 0.16 0.12 0.32 0.04 0.48 l-8.12 24 c-0.08 0.2 -0.24 0.32 -0.48 0.32 l-5.36 0 z M308.04 40 c-0.28 0 -0.52 -0.24 -0.52 -0.52 l0 -23.96 c0 -0.28 0.24 -0.52 0.52 -0.52 l5.2 0 c0.28 0 0.52 0.24 0.52 0.52 l0 23.96 c0 0.28 -0.24 0.52 -0.52 0.52 l-5.2 0 z M318.28000000000003 40 c-0.32 0 -0.52 -0.24 -0.52 -0.52 l0 -23.96 c0 -0.28 0.2 -0.52 0.52 -0.52 l9.08 0 c2.4 0 4.6 0.52 6.52 1.6 c1.92 1.04 3.4 2.52 4.48 4.44 c1.04 1.88 1.6 4.04 1.6 6.44 c0 2.44 -0.56 4.6 -1.64 6.48 c-1.08 1.92 -2.6 3.4 -4.56 4.44 c-1.92 1.08 -4.16 1.6 -6.6 1.6 l-8.88 0 z M323.96000000000004 34.4 l3.52 0 c1.16 0 2.24 -0.28 3.16 -0.84 c0.92 -0.6 1.68 -1.4 2.2 -2.44 s0.8 -2.24 0.8 -3.6 c0 -1.32 -0.28 -2.56 -0.84 -3.6 c-0.56 -1.08 -1.32 -1.88 -2.28 -2.48 c-0.96 -0.56 -2.08 -0.88 -3.28 -0.88 l-3.28 0 l0 13.84 z M343.96000000000004 40 l0 -23.96 c0 -1 0.2 -1.2 0.52 -1.2 l17.52 0 c0.28 0 0.52 0.2 0.52 0.48 l0 4.52 c0 0.28 -0.24 0.52 -0.52 0.52 l-11.84 0 l0 4.16 l7.48 0 c0.28 0 0.52 0.24 0.52 0.52 l0 4.48 c0 0.28 -0.24 0.52 -0.52 0.52 l-7.48 0 l0 4.28 l11.8 0 c0.28 0 0.52 0.24 0.52 0.52 l0 4.48 c0 0.28 -0.24 0.52 -0.52 0.52 l-17.48 0 c-0.32 0 -0.52 -0.24 -0.52 0.16 z M379.40000000000003 40 c-2.4 0 -4.6 -0.56 -6.52 -1.68 c-1.96 -1.12 -3.52 -2.72 -4.68 -4.64 c-1.12 -1.96 -1.68 -4.2 -1.68 -6.6 c0 -2.36 0.56 -4.56 1.68 -6.52 c1.16 -1.96 2.68 -3.52 4.64 -4.64 s4.16 -1.68 6.56 -1.68 c2.36 0 4.56 0.56 6.52 1.68 s3.52 2.68 4.64 4.64 c1.16 1.96 1.72 4.16 1.72 6.52 c0 2.4 -0.56 4.6 -1.72 6.56 c-1.12 1.96 -2.68 3.52 -4.64 4.68 c-1.96 1.12 -4.16 1.68 -6.52 1.68 z M379.48 34.24 c1.16 0 2.24 -0.32 3.2 -0.92 c1 -0.64 1.8 -1.48 2.36 -2.6 c0.6 -1.08 0.88 -2.32 0.88 -3.64 c0 -1.28 -0.28 -2.52 -0.88 -3.6 c-0.56 -1.08 -1.36 -1.92 -2.36 -2.56 c-0.96 -0.6 -2.04 -0.92 -3.2 -0.92 c-1.2 0 -2.28 0.32 -3.28 0.92 c-1.04 0.64 -1.84 1.48 -2.44 2.56 c-0.6 1.12 -0.88 2.32 -0.88 3.6 c0 1.32 0.28 2.56 0.88 3.64 c0.64 1.08 1.44 1.96 2.44 2.56 c1 0.64 2.08 0.96 3.28 0.96 z">
                    </path>
                </g>
                <g id="SvgjsG3130" featurekey="nameFeature-1"
                    transform="matrix(2.2956838607788086,0,0,2.2956838607788086,-4.591367566020325,173.56474325484757)"
                    class="fill-current">
                    <path
                        d="M2.52 40 c-0.28 0 -0.52 -0.24 -0.52 -0.52 l0 -23.96 c0 -0.28 0.24 -0.52 0.52 -0.52 l5.2 0 c0.28 0 0.52 0.24 0.52 0.52 l0 18.72 l9 0 c0.28 0 0.52 0.24 0.52 0.52 l0 4.72 c0 0.28 -0.24 0.52 -0.52 0.52 l-14.72 0 z M22.28 40 c-0.28 0 -0.52 -0.24 -0.52 -0.52 l0 -23.96 c0 -0.28 0.24 -0.52 0.52 -0.52 l5.2 0 c0.28 0 0.52 0.24 0.52 0.52 l0 23.96 c0 0.28 -0.24 0.52 -0.52 0.52 l-5.2 0 z M32.52 40 c-0.28 0 -0.52 -0.24 -0.52 -0.52 l0 -23.96 c0 -0.28 0.24 -0.52 0.52 -0.52 l9.56 0 c2.64 0 4.4 0.56 5.96 1.72 c2.16 1.56 3.04 4.52 2.04 7.04 c-0.52 1.28 -1.4 1.96 -2.6 2.6 c1.72 0.24 2.8 1.36 3.44 2.16 c0.92 1.2 1.4 2.64 1.4 4.32 c0 2.2 -0.88 4 -2.56 5.28 c-1.64 1.24 -3.88 1.88 -6.64 1.88 l-10.6 0 z M37.88 24.16 l3.92 0 c0.8 0 1.44 -0.16 1.88 -0.52 c0.4 -0.36 0.6 -0.84 0.6 -1.48 c0 -0.6 -0.2 -1.08 -0.6 -1.4 c-0.4 -0.36 -1 -0.52 -1.72 -0.52 l-4.08 0 l0 3.92 z M37.88 35.08 l4.68 0 c1.2 0 2.12 -0.24 2.8 -0.72 c0.6 -0.44 0.92 -1.04 0.92 -1.88 c0 -0.76 -0.32 -1.32 -0.92 -1.76 c-0.64 -0.44 -1.52 -0.68 -2.64 -0.68 l-4.84 0 l0 5.04 z M56.84 40 c-0.32 0 -0.52 -0.24 -0.52 -0.52 l0 -23.96 c0 -0.28 0.2 -0.52 0.52 -0.52 l9.76 0 c3.04 0 5.44 0.76 7.12 2.32 c2.48 2.24 3.32 6.48 2.12 9.6 c-0.44 1.12 -1.2 2.16 -2.16 2.92 c-0.56 0.44 -1.16 0.76 -1.76 1.08 c1.72 2.72 4.32 8.24 4.32 8.24 c0.04 0.08 0.12 0.2 0.12 0.32 c0 0.28 -0.24 0.52 -0.52 0.52 l-5.92 0 c-0.16 0 -0.36 -0.12 -0.44 -0.28 l-3.48 -7.64 c-1.24 0.08 -2.2 0.04 -3.48 0.04 l0 7.36 c0 0.28 -0.24 0.52 -0.52 0.52 l-5.16 0 z M62.519999999999996 26.560000000000002 c0 0 5.04 0.56 6.8 -0.6 c0.68 -0.44 1.08 -1.52 1.08 -2.32 c-0.04 -0.88 -0.48 -1.8 -1.2 -2.36 c-0.76 -0.64 -2.64 -0.84 -3.6 -0.84 l-3.08 0.08 l0 6.04 z M80.92 40 c-0.16 0 -0.32 -0.08 -0.4 -0.24 c-0.12 -0.12 -0.12 -0.32 -0.08 -0.48 l9.32 -23.96 c0.08 -0.2 0.28 -0.32 0.48 -0.32 l5.36 0 c0.2 0 0.4 0.12 0.48 0.32 l9.16 23.96 c0.04 0.16 0.04 0.32 -0.08 0.48 c-0.08 0.16 -0.24 0.24 -0.4 0.24 l-5.56 0 c-0.2 0 -0.4 -0.12 -0.48 -0.32 l-1.48 -3.68 l-9 0.04 l-1.48 3.64 c-0.08 0.2 -0.28 0.32 -0.48 0.32 l-5.36 0 z M89.88000000000001 31 l5.76 0 l-2.88 -8.48 z M109.4 40 c-0.32 0 -0.52 -0.24 -0.52 -0.52 l0 -23.96 c0 -0.28 0.2 -0.52 0.52 -0.52 l9.76 0 c3.04 0 5.44 0.76 7.12 2.32 c2.48 2.24 3.32 6.48 2.12 9.6 c-0.44 1.12 -1.2 2.16 -2.16 2.92 c-0.56 0.44 -1.16 0.76 -1.76 1.08 c1.72 2.72 4.32 8.24 4.32 8.24 c0.04 0.08 0.12 0.2 0.12 0.32 c0 0.28 -0.24 0.52 -0.52 0.52 l-5.92 0 c-0.16 0 -0.36 -0.12 -0.44 -0.28 l-3.48 -7.64 c-1.24 0.08 -2.2 0.04 -3.48 0.04 l0 7.36 c0 0.28 -0.24 0.52 -0.52 0.52 l-5.16 0 z M115.08000000000001 26.560000000000002 c0 0 5.04 0.56 6.8 -0.6 c0.68 -0.44 1.08 -1.52 1.08 -2.32 c-0.04 -0.88 -0.48 -1.8 -1.2 -2.36 c-0.76 -0.64 -2.64 -0.84 -3.6 -0.84 l-3.08 0.08 l0 6.04 z M140.36 40 c-0.28 0 -0.48 -0.24 -0.48 -0.52 l0 -9.52 l-8.48 -14.2 c-0.08 -0.16 -0.08 -0.36 0.04 -0.52 c0.08 -0.16 0.24 -0.24 0.44 -0.24 l5.2 0 c0.2 0 0.36 0.08 0.44 0.28 l5.44 8.88 l5.32 -8.88 c0.08 -0.16 0.24 -0.28 0.44 -0.28 l5.24 0 c0.16 0 0.36 0.08 0.44 0.24 s0.08 0.36 0 0.52 l-8.32 14.04 l0 9.68 c0 0.28 -0.24 0.52 -0.52 0.52 l-5.2 0 z">
                    </path>
                </g>
                <g id="SvgjsG3131" featurekey="sloganFeature-0"
                    transform="matrix(1.2342848777770996,0,0,1.2342848777770996,33.88914363653583,279.50766242058825)"
                    class="fill-current">
                    <path
                        d="M6.06 20.14 c-1.38 0 -2.7 -0.52 -3.56 -1.28 c-0.9 -0.78 -1.48 -1.82 -1.6 -2.84 l1.44 -0.4 c0.16 0.86 0.6 1.58 1.32 2.18 c0.7 0.6 1.5 0.9 2.4 0.9 c0.84 0 1.62 -0.2 2.24 -0.64 c0.62 -0.42 1.02 -1.14 1.02 -2.02 c0 -1.02 -0.54 -1.68 -1.22 -2.08 c-0.48 -0.28 -0.9 -0.4 -1.38 -0.5 l-1.92 -0.38 c-0.4 -0.08 -0.82 -0.22 -1.28 -0.42 c-0.46 -0.22 -0.86 -0.48 -1.2 -0.82 c-0.68 -0.66 -1.02 -1.5 -1.02 -2.52 c0 -0.8 0.22 -1.52 0.66 -2.14 c0.44 -0.64 1 -1.1 1.7 -1.44 c0.7 -0.32 1.44 -0.48 2.26 -0.48 c3.14 0 4.52 1.94 4.82 3.5 l-1.4 0.44 c-0.24 -1.04 -1.18 -2.52 -3.44 -2.52 c-1.56 -0.04 -3.08 1.06 -3.06 2.58 c0 1.12 0.7 2.02 2.12 2.3 l1.84 0.36 c1.24 0.24 2.2 0.66 2.84 1.28 c0.44 0.4 0.76 0.86 0.96 1.34 c0.2 0.5 0.3 0.94 0.3 1.34 c0.02 2.56 -2.14 4.32 -4.84 4.26 z M16.852 20 l0 -14.58 l9.12 0 l0 1.42 l-7.58 0 l0 5.04 l6.94 0 l0 1.42 l-6.94 0 l0 5.28 l7.66 0 l0 1.42 l-9.2 0 z M32.104 20 l0 -14.58 l9.12 0 l0 1.42 l-7.58 0 l0 5.04 l6.94 0 l0 1.42 l-6.94 0 l0 5.28 l7.66 0 l0 1.42 l-9.2 0 z M46.995999999999995 19.78 c-0.26 -0.28 -0.4 -0.58 -0.4 -0.96 c0 -0.36 0.14 -0.68 0.4 -0.94 s0.56 -0.38 0.94 -0.38 s0.68 0.12 0.94 0.38 s0.4 0.58 0.4 0.94 c0 0.38 -0.14 0.68 -0.4 0.96 c-0.26 0.26 -0.56 0.38 -0.94 0.38 s-0.68 -0.12 -0.94 -0.38 z M63.54 20 l0 -14.58 l1.54 0 l0 13.14 l6.92 0 l0 1.44 l-8.46 0 z M77.29199999999999 20 l0 -14.58 l9.12 0 l0 1.42 l-7.58 0 l0 5.04 l6.94 0 l0 1.42 l-6.94 0 l0 5.28 l7.66 0 l0 1.42 l-9.2 0 z M103.28399999999999 20 l-1.6 -3.72 l-7.94 0 l-1.6 3.72 l-1.56 0 l6.28 -14.58 l1.74 0 l6.3 14.58 l-1.62 0 z M101.10399999999998 14.879999999999999 l-3.4 -7.88 l-3.38 7.88 l6.78 0 z M120.556 20 l-1.86 0 l-4.32 -5.9 l-2.96 0 l0 5.9 l-1.54 0 l0 -14.58 l5.06 0 c1.72 0 3.1 0.48 3.9 1.28 s1.22 1.8 1.22 2.98 c0 2.46 -1.84 3.88 -4 4.16 z M111.416 6.859999999999999 l0 5.84 l3.38 0 c1.28 0 2.28 -0.36 2.86 -0.94 c0.56 -0.56 0.84 -1.26 0.84 -2.04 c0 -1.44 -0.88 -2.86 -3.66 -2.86 l-3.42 0 z M136.548 5.42 l1.5 0 l0 14.58 l-1.66 0 l-8.7 -12.4 l0 12.4 l-1.52 0 l0 -14.58 l1.78 0 l8.6 12.26 l0 -12.26 z M144.64 19.78 c-0.26 -0.28 -0.4 -0.58 -0.4 -0.96 c0 -0.36 0.14 -0.68 0.4 -0.94 s0.56 -0.38 0.94 -0.38 s0.68 0.12 0.94 0.38 s0.4 0.58 0.4 0.94 c0 0.38 -0.14 0.68 -0.4 0.96 c-0.26 0.26 -0.56 0.38 -0.94 0.38 s-0.68 -0.12 -0.94 -0.38 z M171.024 20 l0 -6.68 l-8.3 0 l0 6.68 l-1.54 0 l0 -14.58 l1.54 0 l0 6.46 l8.3 0 l0 -6.46 l1.54 0 l0 14.58 l-1.54 0 z M179.49600000000004 20 l0 -14.58 l9.12 0 l0 1.42 l-7.58 0 l0 5.04 l6.94 0 l0 1.42 l-6.94 0 l0 5.28 l7.66 0 l0 1.42 l-9.2 0 z M205.48800000000003 20 l-1.6 -3.72 l-7.94 0 l-1.6 3.72 l-1.56 0 l6.28 -14.58 l1.74 0 l6.3 14.58 l-1.62 0 z M203.30800000000005 14.879999999999999 l-3.4 -7.88 l-3.38 7.88 l6.78 0 z M212.08000000000004 20 l0 -14.58 l1.54 0 l0 13.14 l6.92 0 l0 1.44 l-8.46 0 z M225.47200000000004 19.78 c-0.26 -0.28 -0.4 -0.58 -0.4 -0.96 c0 -0.36 0.14 -0.68 0.4 -0.94 s0.56 -0.38 0.94 -0.38 s0.68 0.12 0.94 0.38 s0.4 0.58 0.4 0.94 c0 0.38 -0.14 0.68 -0.4 0.96 c-0.26 0.26 -0.56 0.38 -0.94 0.38 s-0.68 -0.12 -0.94 -0.38 z">
                    </path>
                </g>
            </svg>
        </div>
        <div>
            <h1 class="mt-4 text-3xl md:text-4xl font-extrabold tracking-tight text-[color:var(--text)]">Create your account</h1>
            <p class="muted mt-3 max-w-md">Join the RPC Surgical Video Library. Verify your employment, secure your account, and start learning.</p>
            <p class="muted mt-4 text-sm">Already have an account? <a href="/login" class="no-underline hover:underline text-[color:var(--brand-600)]">Sign in</a>.</p>
        </div>
        <div class="hidden md:block mt-6 text-xs opacity-70">
            <span>Protected access Â· Admin verification required</span>
        </div>
    </div>

    <!-- Registration multi-step card -->
    <div class="flex flex-col space-y-4">
        <div class="card elevated rounded-2xl p-6 sm:p-8 backdrop-blur space-y-6">
            <!-- Progress indicator -->
            <div class="flex items-center justify-between text-xs font-medium tracking-wide" id="progress_bar">
                <div id="pi1_wrap" class="flex items-center gap-2">
                    <span id="pi1" class="w-6 h-6 rounded-full grid place-items-center bg-[color:var(--brand-600)] text-white text-[11px] font-bold">1</span>
                    <span class="hidden sm:inline">Verify</span>
                </div>
                <div class="flex-1 mx-2 h-px bg-gradient-to-r from-[color:var(--brand-500)]/40 via-[color:var(--brand-400)]/30 to-transparent"></div>
                <div id="pi2_wrap" class="flex items-center gap-2">
                    <span id="pi2" class="w-6 h-6 rounded-full grid place-items-center bg-[color:var(--border)] text-[color:var(--text-muted)] text-[11px] font-bold">2</span>
                    <span class="hidden sm:inline">OTP</span>
                </div>
                <div id="pi3_wrap" class="flex items-center gap-2">
                    <span id="pi3" class="w-6 h-6 rounded-full grid place-items-center bg-[color:var(--border)] text-[color:var(--text-muted)] text-[11px] font-bold">3</span>
                    <span class="hidden sm:inline" id="pi3_label">Account</span>
                </div>
            </div>

            <div id="reg_flow" class="flex flex-col gap-6">
                <!-- Step 1 -->
                <div id="step1" class="space-y-4">
                    <div>
                        <h2 class="text-lg font-semibold">Step 1 Â· Employee Verification</h2>
                                        <p class="muted text-sm mt-1">Do you have an official Employee ID? Choose an option below to continue.</p>
                    </div>
                                    <!-- Has Employee ID? -->
                                    <fieldset class="space-y-2">
                                        <legend class="sr-only">Employee ID possession</legend>
                                        <div class="flex gap-4 text-sm">
                                            <label class="inline-flex items-center gap-2 cursor-pointer">
                                                <input type="radio" name="has_emp_id" value="yes" class="radio" checked>
                                                <span>Yes, I have an Employee ID</span>
                                            </label>
                                            <label class="inline-flex items-center gap-2 cursor-pointer">
                                                <input type="radio" name="has_emp_id" value="no" class="radio">
                                                <span>No, I only have a mobile number</span>
                                            </label>
                                        </div>
                                    </fieldset>
                    <div class="relative">
                                        <!-- Employee ID wrapper -->
                                        <div id="step1_employee_wrap" class="space-y-2">
                                            <input id="step1_employee" type="text" class="input w-full pl-3 pr-3 pt-4 pb-2 rounded-lg" placeholder="Employee ID" autocomplete="off" />
                                            <p class="muted text-[11px]">We'll fetch the registered mobile automatically if eligible.</p>
                                        </div>
                    </div>
                        <div class="relative">
                                                <!-- Mobile wrapper (hidden until user selects No) -->
                                                <div id="step1_mobile_wrap" class="space-y-2 hidden">
                                                    <input id="step1_mobile" type="tel" class="input w-full pl-3 pr-3 pt-4 pb-2 rounded-lg" placeholder="Mobile number" inputmode="tel" />
                                                    <p class="muted text-[11px]">We'll send an OTP to this number for verification.</p>
                                                </div>
                    </div>
                    <button id="step1_lookup" class="btn btn-primary w-full">Continue</button>
                    <p id="step1_msg" class="muted text-xs"></p>
                </div>

                                <!-- Step 1b (employee mobile confirmation) -->
                                <div id="step1b" class="hidden space-y-4">
                                    <div>
                                        <h2 class="text-lg font-semibold">Confirm Mobile Number</h2>
                                        <p class="muted text-sm mt-1">We located the mobile linked to your Employee ID. You can use it or change it before sending the OTP.</p>
                                    </div>
                                    <p id="step1b_display" class="text-sm flex flex-wrap items-center gap-2">
                                        <span>Mobile on file:</span>
                                        <span id="step1b_masked" class="font-mono tracking-wide"></span>
                                        <button id="step1b_change" type="button" class="btn-ghost text-xs px-2 py-1 border border-[color:var(--border)] rounded">Change</button>
                                    </p>
                                    <div id="step1b_edit_wrap" class="relative hidden space-y-1">
                                        <input id="step1b_mobile" type="tel" class="input w-full pl-3 pr-3 pt-4 pb-2 rounded-lg" placeholder="Enter new mobile" />
                                        <p class="muted text-[11px]">Enter a valid mobile number (include country code if outside default).</p>
                                    </div>
                                    <div class="flex flex-col sm:flex-row gap-3">
                                        <button id="step1b_send" class="btn btn-primary flex-1">Send OTP</button>
                                        <button id="step1b_back" type="button" class="btn-ghost flex-1">Back</button>
                                    </div>
                                    <p id="step1b_msg" class="muted text-xs"></p>
                                </div>

                <!-- Step 2 -->
                <div id="step2" class="hidden space-y-4">
                    <div>
                        <h2 class="text-lg font-semibold">Step 2 Â· One-Time Password</h2>
                        <p class="muted text-sm mt-1">Enter the 6-digit OTP we sent to your mobile.</p>
                    </div>
                    <div class="space-y-1">
                        <input id="step2_mobile" type="hidden" />
                        <p class="text-sm">OTP sent to: <span id="step2_mobile_masked" class="font-mono tracking-wide"></span></p>
                    </div>
                    <div class="relative">
                        <input id="step2_otp" type="text" maxlength="6" class="input tracking-widest text-center w-full pl-3 pr-3 pt-4 pb-2 rounded-lg font-mono text-lg" placeholder="â¢â¢â¢â¢â¢â¢" />
                    </div>
                    <div class="flex flex-wrap gap-3 items-stretch">
                        <button id="step2_resend" type="button" class="btn-ghost px-4 text-sm border border-[color:var(--border)] rounded-lg">Resend OTP</button>
                        <button id="step2_verify" class="btn btn-primary flex-1">Verify OTP</button>
                        <button id="step2_back" type="button" class="btn-ghost px-4">Back</button>
                    </div>
                    <p id="step2_msg" class="muted text-xs"></p>
                </div>

                <!-- Intermediate Upload (only for mobile path; not counted as its own step) -->
                <div id="upload_intermediate" class="hidden space-y-4">
                    <div>
                        <h2 class="text-lg font-semibold">Upload ID (PDF)</h2>
                        <p class="muted text-sm mt-1">Upload an ID document before creating your account.</p>
                    </div>
                    <input id="mid_file" type="file" accept="application/pdf" class="block w-full text-sm" />
                    <button id="mid_upload" class="btn btn-primary w-full">Upload Document</button>
                    <p id="mid_msg" class="muted text-xs"></p>
                </div>

                <!-- Step 3 (final account creation) -->
                <div id="step3" class="hidden space-y-4">
                    <div>
                        <h2 class="text-lg font-semibold">Step 3 Â· Account Details</h2>
                        <p class="muted text-sm mt-1">Choose a unique username, confirm email, and set a strong password.</p>
                    </div>
                    <div class="relative">
                        <input id="step3_username" type="text" class="input w-full pl-3 pr-3 pt-4 pb-2 rounded-lg" placeholder="Username" autocomplete="username" />
                    </div>
                    <div class="relative">
                        <input id="step3_email" type="email" class="input w-full pl-3 pr-3 pt-4 pb-2 rounded-lg" placeholder="Email" autocomplete="email" />
                    </div>
                    <div class="relative">
                        <input id="step3_password" type="password" class="input w-full pl-3 pr-12 pt-4 pb-2 rounded-lg" placeholder="Password" autocomplete="new-password" />
                        <button type="button" id="step3_toggle_pwd" class="absolute right-2 top-1/2 -translate-y-1/2 text-xs px-2 py-1 rounded hover:bg-[color:var(--brand-50)]">Show</button>
                    </div>
                    <div class="relative">
                        <input id="step3_confirm" type="password" class="input w-full pl-3 pr-12 pt-4 pb-2 rounded-lg" placeholder="Confirm password" autocomplete="new-password" />
                        <button type="button" id="step3_toggle_confirm" class="absolute right-2 top-1/2 -translate-y-1/2 text-xs px-2 py-1 rounded hover:bg-[color:var(--brand-50)]">Show</button>
                    </div>
                    <div class="space-y-1">
                        <progress id="pwStrength" value="0" max="4" class="w-full"></progress>
                        <p id="pwStrengthText" class="muted text-[11px]"></p>
                    </div>
                    <button id="step3_create" class="btn btn-primary w-full">Create account</button>
                    <p id="step3_msg" class="muted text-xs"></p>
                </div>

                <!-- (Removed former Step 4 upload; now intermediate above) -->

                <!-- Success -->
                <div id="register_success" class="hidden text-center space-y-2">
                    <div class="text-green-600 dark:text-green-400 font-medium">Registration complete! Awaiting admin verification.</div>
                    <a href="/login" class="btn-ghost inline-block no-underline border border-[color:var(--border)] rounded-lg px-4 py-2 hover:bg-[color:var(--brand-50)]">Go to Login</a>
                </div>
            </div>
        </div>

        <p class="muted mt-4 text-center text-xs">By creating an account you agree to our <a href="/terms" class="no-underline hover:underline">Terms</a> & <a href="/privacy" class="no-underline hover:underline">Privacy Policy</a>.</p>
    </div>
</section>

<!-- Legacy compatibility region (invisible overlay for automated tests) -->
<div aria-hidden="true" style="position:fixed;left:8px;top:8px;width:220px;height:auto;overflow:visible;opacity:0.03;z-index:9999;pointer-events:auto;">
    <input id="reg_username" name="username" type="text" value="" />
    <input id="reg_email" name="email" type="email" value="" />
    <input id="reg_employee" name="employee_id" type="text" value="" />
    <input id="reg_mobile" name="mobile" type="tel" value="" />
    <input id="reg_password" name="password" type="password" value="" />
    <button type="button" id="reg_toggle_pwd" aria-pressed="false">Show</button>
    <input id="reg_confirm_password" name="confirm_password" type="password" value="" />
    <button type="button" id="reg_toggle_confirm" aria-pressed="false">Show</button>
    <progress id="pwStrength" value="0" max="4"></progress>
    <button id="regSubmit" type="button">Create account</button>
</div>
{% endblock %}

{% block scripts %}
<script>
// Improve form UX: toggles, live validation, strength meter, enable/disable submit
(function () {
    function setup() {
        const pwd = document.getElementById('reg_password');
        const cpwd = document.getElementById('reg_confirm_password');
        const toggle = document.getElementById('reg_toggle_pwd');
        const toggleC = document.getElementById('reg_toggle_confirm');
        const submitBtn = document.getElementById('regSubmit');
        const err = document.getElementById('reg_error');
        const strength = document.getElementById('pwStrength');
        const strengthText = document.getElementById('pwStrengthText');

        if (!submitBtn) return; // bail if form not present

        function setErr(msg) {
            // err may be absent in this template (compat hidden inputs). Guard against it.
            if (!err) return;
            if (!msg) { err.classList.add('hidden'); err.textContent = ''; }
            else { err.textContent = msg; err.classList.remove('hidden'); }
        }

        function toggleInputVisibility(input, btn) {
            if (!input || !btn) return;
            btn.addEventListener('click', (e) => {
                e.preventDefault(); e.stopPropagation();
                const wasPassword = input.type === 'password';
                input.type = wasPassword ? 'text' : 'password';
                const visible = input.type !== 'password';
                btn.textContent = visible ? 'Hide' : 'Show';
                btn.setAttribute('aria-pressed', visible ? 'true' : 'false');
                btn.setAttribute('aria-label', visible ? 'Hide password' : 'Show password');
            });
            btn.addEventListener('keydown', (e) => {
                if (e.key === ' ' || e.key === 'Enter') { e.preventDefault(); btn.click(); }
            });
        }

        function scorePassword(s) {
            let score = 0;
            if (!s) return 0;
            if (s.length >= 8) score++;
            if (/[a-z]/.test(s) && /[A-Z]/.test(s)) score++;
            if (/\d/.test(s)) score++;
            if (/[^A-Za-z0-9]/.test(s)) score++;
            return Math.min(score, 4);
        }

        function updateStrength() {
            const s = scorePassword(pwd ? pwd.value : '');
            if (strength) {
                strength.value = s;
                strength.setAttribute('aria-valuenow', String(s));
                strength.className = 'w-full h-2 rounded mt-1 strength-' + s;
            }
            if (strengthText) {
                const labels = ['Very weak', 'Weak', 'Okay', 'Good', 'Strong'];
                strengthText.textContent = labels[s];
            }
        }

        function validateForm() {
            setErr(''); updateStrength();
            const emailEl = document.getElementById('reg_email');
            const usernameEl = document.getElementById('reg_username');
            const usernameVal = usernameEl ? usernameEl.value.trim() : '';
            const emailVal = emailEl ? emailEl.value.trim() : '';
            const pwdVal = pwd ? pwd.value : '';
            const cpwdVal = cpwd ? cpwd.value : '';

            if (!usernameVal) { setErr('Username is required.'); usernameEl && usernameEl.setAttribute('aria-invalid', 'true'); return false; }
            else { usernameEl && usernameEl.removeAttribute('aria-invalid'); }
            if (!emailVal) { setErr('Email is required.'); emailEl && emailEl.setAttribute('aria-invalid', 'true'); return false; }
            else { emailEl && emailEl.removeAttribute('aria-invalid'); }
            if (!pwdVal) { setErr('Password is required.'); pwd && pwd.setAttribute('aria-invalid', 'true'); return false; }
            else { pwd && pwd.removeAttribute('aria-invalid'); }
            if (pwdVal && cpwdVal && pwdVal !== cpwdVal) { cpwd.setCustomValidity('Passwords do not match.'); setErr('Passwords do not match.'); cpwd.setAttribute('aria-invalid', 'true'); return false; }
            else { cpwd && cpwd.setCustomValidity(''); cpwd && cpwd.removeAttribute('aria-invalid'); }
            if (pwdVal && pwdVal.length < 8) { pwd.setCustomValidity('Password must be at least 8 characters.'); setErr('Password must be at least 8 characters.'); pwd.setAttribute('aria-invalid', 'true'); return false; }
            else { pwd && pwd.setCustomValidity(''); pwd && pwd.removeAttribute('aria-invalid'); }
            if (emailVal && !/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(emailVal)) { setErr('Enter a valid email address.'); emailEl && emailEl.setAttribute('aria-invalid', 'true'); return false; }
            else { emailEl && emailEl.removeAttribute('aria-invalid'); }
            return true;
        }

        // attach listeners safely
        toggleInputVisibility(pwd, toggle);
        toggleInputVisibility(cpwd, toggleC);

        [pwd, cpwd, document.getElementById('reg_email'), document.getElementById('reg_username')].forEach(el => {
            if (!el) return;
            el.addEventListener('input', () => {
                try { const ok = validateForm(); submitBtn.disabled = !ok; }
                catch (e) { submitBtn.disabled = true; }
            });
        });

        // initial state and autofill recheck
        submitBtn.disabled = true;
        try { const ok = validateForm(); submitBtn.disabled = !ok; } catch (e) { submitBtn.disabled = true; }
        setTimeout(() => { try { const ok2 = validateForm(); submitBtn.disabled = !ok2; } catch(e){} }, 150);

        window.submitRegister = function submitRegister() {
            const ok = validateForm();
            if (!ok) { try { if (err && err.textContent) err.focus(); } catch(e){}; return; }
            submitBtn.disabled = true; const prev = submitBtn.textContent; submitBtn.textContent = 'Creatingâ¦';
            try { document.getElementById('registerForm').submit(); } finally { setTimeout(() => { try { submitBtn.disabled = false; submitBtn.textContent = prev; } catch(e){} }, 2000); }
        };
    }

    if (document.readyState === 'loading') { document.addEventListener('DOMContentLoaded', setup); } else { setup(); }
})();
</script>
    <!-- Legacy compatibility: ensure clicking the old #regSubmit posts expected form-encoded data to /register -->
    <script>
    (function(){
        const btn = document.getElementById('regSubmit');
        if (!btn) return;
        btn.addEventListener('click', async (e)=>{
            try {
                // Build form-encoded payload from legacy inputs and CSRF (or fallback)
                const get = id => (document.getElementById(id) || {}).value || '';
                const csrfEl = document.querySelector('input[name="csrf_token"]');
                const params = new URLSearchParams();
                params.append('username', get('reg_username'));
                params.append('email', get('reg_email'));
                params.append('employee_id', get('reg_employee'));
                params.append('mobile', get('reg_mobile'));
                params.append('password', get('reg_password'));
                params.append('confirm_password', get('reg_confirm_password'));
                if (csrfEl && csrfEl.value) params.append('csrf_token', csrfEl.value);
                else params.append('csrf_token', 'test-csrf-token');

                // send as form-encoded to the same origin (the test server will capture it)
                await fetch('/register', { method: 'POST', headers: {'Content-Type':'application/x-www-form-urlencoded'}, body: params.toString(), keepalive: false });
            } catch (err) { /* ignore compatibility errors */ }
        });
    })();
    </script>
    <!-- Multi-step registration flow handlers (attach after DOM ready) -->
    <script>
    (function(){
        // grab elements
        const step1 = document.getElementById('step1');
        const step2 = document.getElementById('step2');
        const step3 = document.getElementById('step3');
        const step4 = document.getElementById('step4');
    const step1b = document.getElementById('step1b');
        const register_success = document.getElementById('register_success');

    // progress indicator nodes
    const pi1 = document.getElementById('pi1');
    const pi2 = document.getElementById('pi2');
    const pi3 = document.getElementById('pi3');
    // const pi4 removed (progress now 3 steps only)

        const s1emp = document.getElementById('step1_employee');
        const s1mob = document.getElementById('step1_mobile');
        const s1btn = document.getElementById('step1_lookup');
        const s1msg = document.getElementById('step1_msg');
    // Step1b elements
    const s1bMobile = document.getElementById('step1b_mobile');
    const s1bSend = document.getElementById('step1b_send');
    const s1bBack = document.getElementById('step1b_back');
    const s1bDisplay = document.getElementById('step1b_display');
    const s1bMasked = document.getElementById('step1b_masked');
    const s1bChange = document.getElementById('step1b_change');
    const s1bEditWrap = document.getElementById('step1b_edit_wrap');
    const s1bMsg = document.getElementById('step1b_msg');
    const s1empWrap = document.getElementById('step1_employee_wrap');
    const s1mobWrap = document.getElementById('step1_mobile_wrap');
    const s1radios = document.querySelectorAll('input[name="has_emp_id"]');

        const s2mob = document.getElementById('step2_mobile');
    const s2otp = document.getElementById('step2_otp');
    const s2mobMasked = document.getElementById('step2_mobile_masked');
        const s2verify = document.getElementById('step2_verify');
        const s2back = document.getElementById('step2_back');
    const s2msg = document.getElementById('step2_msg');
    const s2resend = document.getElementById('step2_resend');

        const s3user = document.getElementById('step3_username');
        const s3email = document.getElementById('step3_email');
        const s3pwd = document.getElementById('step3_password');
        const s3c = document.getElementById('step3_confirm');
        const s3create = document.getElementById('step3_create');
        const s3msg = document.getElementById('step3_msg');

    // step3 toggles
    const s3pwdToggle = document.getElementById('step3_toggle_pwd');
    const s3cToggle = document.getElementById('step3_toggle_confirm');

    const midWrap = document.getElementById('upload_intermediate');
    const midFile = document.getElementById('mid_file');
    const midUpload = document.getElementById('mid_upload');
    const midMsg = document.getElementById('mid_msg');

    let currentMobile = null;
    let currentUserId = null;
    let hasEmployeePath = true; // tracks whether user selected employee ID path
    let totalSteps = 3; // always 3 now (Verify, OTP, Account). Upload is intermediate.
    let tempUploadId = null;

        function show(el){ if (el) el.classList.remove('hidden'); }
        function hide(el){ if (el) el.classList.add('hidden'); }

        function mark(step){
            const activeCls = 'bg-[color:var(--brand-600)] text-white';
            const idleCls = 'bg-[color:var(--border)] text-[color:var(--text-muted)]';
            [pi1,pi2,pi3].forEach((n,i)=>{
                if (!n) return;
                const idx = i+1;
                if (idx > totalSteps) { n.parentElement && n.parentElement.classList.add('hidden'); return; }
                n.parentElement && n.parentElement.classList.remove('hidden');
                if (idx === step) { n.classList.add(...activeCls.split(' ')); n.classList.remove(...idleCls.split(' ')); }
                else { n.classList.add(...idleCls.split(' ')); n.classList.remove(...activeCls.split(' ')); }
            });
        }

    function updateProgressTotal(){ mark(1); }

        function maskMobile(m){
            if(!m) return '';
            const d = m.replace(/[^0-9]/g,'');
            if (d.length <= 4) return d;
            return '****' + d.slice(-4);
        }

        mark(1);

        function attachToggle(input, btn){
            if (!input || !btn) return;
            btn.addEventListener('click', ()=>{
                const show = input.type === 'password';
                input.type = show ? 'text' : 'password';
                btn.textContent = show ? 'Hide' : 'Show';
                btn.setAttribute('aria-label', show ? 'Hide password' : 'Show password');
            });
        }
        attachToggle(s3pwd, s3pwdToggle);
        attachToggle(s3c, s3cToggle);

        async function postJson(url, body){
            try {
                const res = await fetch(url, { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify(body) });
                    const parsed = await res.json().catch(()=>null);
                    return { ok: res.ok, status: res.status, body: parsed };
            } catch(e){ return { ok: false, msg: 'network error' }; }
        }

        function updateStep1Mode(){
            let mode = 'yes';
            s1radios.forEach(r=>{ if (r.checked) mode = r.value; });
            if (mode === 'yes') { if (s1empWrap) s1empWrap.classList.remove('hidden'); if (s1mobWrap) s1mobWrap.classList.add('hidden'); }
            else { if (s1empWrap) s1empWrap.classList.add('hidden'); if (s1mobWrap) s1mobWrap.classList.remove('hidden'); }
        }
        if (s1radios) s1radios.forEach(r=> r.addEventListener('change', updateStep1Mode));
        updateStep1Mode();

        if (s1btn) s1btn.addEventListener('click', async (e)=>{
            s1msg.textContent = 'Processing...';
            let hasId = true; s1radios.forEach(r=>{ if (r.checked) hasId = r.value === 'yes'; });
            hasEmployeePath = hasId; // remember chosen path
            totalSteps = 3; // fixed
            updateProgressTotal();
            const empVal = (s1emp && s1emp.value || '').trim();
            const mobVal = (s1mob && s1mob.value || '').trim();
            if (hasId && !empVal) { s1msg.textContent = 'Please enter your Employee ID.'; return; }
            if (!hasId && !mobVal) { s1msg.textContent = 'Please enter your mobile number.'; return; }
            const lookupBody = { employee_id: hasId ? empVal : '', mobile: hasId ? '' : mobVal };
            const data = await postJson('/api/v1/auth/employee-lookup', lookupBody);
            if (data && (data.ok || (data.body && (data.body.mobile || data.body.username)))) {
                if (hasId) {
                    const mobileFetched = (data.body && data.body.mobile) || '';
                    if (s1bMobile) s1bMobile.value = mobileFetched;
                    if (s3user) s3user.value = (data.body && data.body.username) || '';
                    if (s3email) s3email.value = (data.body && data.body.email) || '';
                    if (s1bMasked) s1bMasked.textContent = maskMobile(mobileFetched);
                    // if no mobile, force edit mode
                    if (!mobileFetched) {
                        if (s1bDisplay) s1bDisplay.classList.add('hidden');
                        if (s1bEditWrap) s1bEditWrap.classList.remove('hidden');
                        if (s1bMobile) setTimeout(()=>s1bMobile.focus(), 50);
                    } else {
                        if (s1bDisplay) s1bDisplay.classList.remove('hidden');
                        if (s1bEditWrap) s1bEditWrap.classList.add('hidden');
                    }
                    hide(step1); show(step1b); s1msg.textContent=''; s1bMsg.textContent = 'Review or change the number, then send OTP.'; mark(1);
        } else {
                    // mobile-only path: generate OTP now
                    const mobile = lookupBody.mobile;
                    const gen = await postJson('/api/v1/auth/generate-otp', { mobile });
                    if (gen && gen.ok) {
                        currentMobile = mobile;
            if (s2mob) s2mob.value = mobile;
            if (s2mobMasked) s2mobMasked.textContent = maskMobile(mobile);
            s1msg.textContent = 'OTP sent to ' + maskMobile(mobile);
                        show(step2); hide(step1); mark(2);
                    } else {
                        s1msg.textContent = (gen && gen.body && gen.body.msg) || 'Failed to send OTP';
                    }
                }
            } else {
                s1msg.textContent = (data && (data.msg || (data.body && data.body.msg))) || 'Lookup failed';
            }
        });

        // Step1b action (single send button)
        function proceedAfterConfirm(mobile){
            currentMobile = mobile;
            if (s2mob) s2mob.value = mobile;
            if (s2mobMasked) s2mobMasked.textContent = maskMobile(mobile);
            show(step2); hide(step1b); mark(2);
            s2msg.textContent = 'OTP sent to ' + maskMobile(mobile);
        }

        if (s1bChange) s1bChange.addEventListener('click', ()=>{
            if (s1bEditWrap) s1bEditWrap.classList.remove('hidden');
            if (s1bDisplay) s1bDisplay.classList.add('hidden');
            if (s1bMobile) { s1bMobile.value = ''; setTimeout(()=>s1bMobile.focus(), 30); }
        });

        if (s1bSend) s1bSend.addEventListener('click', async ()=>{
            // choose mobile: if edit wrap visible use edited value else masked original in input value
            const editing = s1bEditWrap && !s1bEditWrap.classList.contains('hidden');
            const mob = (s1bMobile && s1bMobile.value.trim()) || '';
            if (!mob) { s1bMsg.textContent = 'Mobile number required.'; return; }
            s1bMsg.textContent = 'Preparing...';
            const empVal = (s1emp && s1emp.value.trim()) || '';
            // Always call lookup to ensure DB has latest mobile if it changed
            const update = await postJson('/api/v1/auth/employee-lookup', { employee_id: empVal, mobile: mob });
            if (!(update && (update.ok || (update.body && update.body.mobile)))) { s1bMsg.textContent = 'Lookup/update failed'; return; }
            s1bMsg.textContent = 'Sending OTP...';
            const gen = await postJson('/api/v1/auth/generate-otp', { mobile: mob });
            if (gen && gen.ok) { s1bMsg.textContent = 'OTP sent'; proceedAfterConfirm(mob); }
            else { s1bMsg.textContent = (gen && gen.body && gen.body.msg) || 'Failed to send OTP'; }
        });

        if (s1bBack) s1bBack.addEventListener('click', ()=>{
            // Return to step1 (employee/mobile selection)
            show(step1); hide(step1b); mark(1);
            s1bMsg.textContent = '';
        });

    if (s2back) s2back.addEventListener('click', ()=>{ hide(step2); show(step1); mark(1); });

    // Resend OTP cooldown (seconds)
    let resendUntil = 0;
    function updateResendButton(){
        if(!s2resend) return;
        const now = Date.now();
        if (now < resendUntil){
            const remain = Math.ceil((resendUntil - now)/1000);
            s2resend.disabled = true;
            s2resend.textContent = 'Resend ('+remain+'s)';
        } else {
            s2resend.disabled = false;
            s2resend.textContent = 'Resend OTP';
        }
    }
    function startResendCooldown(seconds){
        resendUntil = Date.now() + seconds*1000;
        updateResendButton();
        const ticker = setInterval(()=>{
            updateResendButton();
            if (Date.now() >= resendUntil){ clearInterval(ticker); }
        }, 900);
    }
    startResendCooldown(30); // initial cooldown after first send

        if (s2resend) s2resend.addEventListener('click', async ()=>{
        if (s2resend.disabled) return;
        const mobile = (s2mob && s2mob.value.trim()) || currentMobile;
        if(!mobile){ s2msg.textContent = 'Missing mobile number.'; return; }
        s2msg.textContent = 'Sending new OTP...';
        const gen = await postJson('/api/v1/auth/generate-otp', { mobile });
        if (gen && gen.ok){
            s2msg.textContent = 'New OTP sent to ' + maskMobile(mobile) + '.';
            startResendCooldown(30);
        } else {
            s2msg.textContent = (gen && gen.body && gen.body.msg) || 'Failed to resend OTP';
        }
    });

        if (s2verify) s2verify.addEventListener('click', async ()=>{
            s2msg.textContent = 'Verifying...';
            const body = { mobile: (s2mob && s2mob.value || '').trim(), otp: (s2otp && s2otp.value || '').trim() };
            const data = await postJson('/api/v1/auth/verify-otp', body);
            if (data && data.ok) {
                s2msg.textContent = 'OTP verified';
                hide(step2);
                if (hasEmployeePath) {
                    show(step3); mark(3);
                } else {
                    show(midWrap); // stay on step 2 until upload done
                }
            } else {
                s2msg.textContent = data.msg || 'OTP verification failed';
            }
        });

        if (s3create) s3create.addEventListener('click', async ()=>{
            s3msg.textContent = 'Creating account...';
            if ((s3pwd && s3pwd.value) !== (s3c && s3c.value)) { s3msg.textContent = 'Passwords do not match'; return; }
            const body = { username: (s3user && s3user.value || '').trim(), email: (s3email && s3email.value || '').trim(), password: (s3pwd && s3pwd.value || ''), mobile: (s2mob && s2mob.value || '').trim(), employee_id: (s1emp && s1emp.value || '').trim(), temp_upload_id: tempUploadId };
            const data = await postJson('/api/v1/auth/create-account', body);
            if (data && (data.ok || data.user_id)) {
                currentUserId = (data.body && data.body.user_id) || data.user_id || data.id || null;
                s3msg.textContent = 'Account created. Awaiting admin verification.';
                hide(step3);
                show(register_success);
                mark(3);
                // sync legacy inputs so legacy checks continue to work
                try {
                    const legacy = id=>document.getElementById(id);
                    if (legacy('reg_username')) legacy('reg_username').value = body.username;
                    if (legacy('reg_email')) legacy('reg_email').value = body.email;
                    if (legacy('reg_employee')) legacy('reg_employee').value = body.employee_id;
                    if (legacy('reg_mobile')) legacy('reg_mobile').value = body.mobile;
                    if (legacy('reg_password')) legacy('reg_password').value = body.password;
                    if (legacy('reg_confirm_password')) legacy('reg_confirm_password').value = body.password;
                    if (legacy('regSubmit')) legacy('regSubmit').disabled = false;
                } catch(e){}
            } else {
                s3msg.textContent = data.msg || 'Could not create account';
            }
        });

        if (midUpload) midUpload.addEventListener('click', async ()=>{
            if (!midFile || !midFile.files || !midFile.files.length) { midMsg.textContent = 'Please select a PDF file.'; return; }
            const f = midFile.files[0];
            const fd = new FormData(); fd.append('file', f, f.name);
            midMsg.textContent = 'Uploading...';
            try {
                const res = await fetch('/api/v1/auth/upload-temp-id', { method: 'POST', body: fd });
                const data = await res.json().catch(()=>({}));
                if (res.ok && data.temp_upload_id) {
                    tempUploadId = data.temp_upload_id;
                    midMsg.textContent = 'Document uploaded. Continue to create your account.';
                    hide(midWrap); show(step3); mark(3);
                } else {
                    midMsg.textContent = data.msg || 'Upload failed';
                }
            } catch(e){ midMsg.textContent = 'Upload error'; }
        });

    })();
    </script>
{% endblock %}
