{% extends "layout.html" %}
{% block title %}Search ¬∑ RPC Surgical Video Library{% endblock %}

{% block content %}
<main class="flex gap-6">
    <!-- LEFT FILTERS -->
    <aside class="lg:block w-72 shrink-0">
        <div class="card p-4 sticky top-20 space-y-5" id="filtersPanel">
            <div class="flex items-center justify-between">
                <h2 class="text-lg font-bold text-[color:var(--text)]">Filters</h2>
                <button id="clearAllFilters"
                    class="btn-ghost text-sm px-2 py-1 border border-[color:var(--border)] rounded">Reset</button>
            </div>

            <!-- Categories -->
            <section>
                <h3 class="label">Categories</h3>
                <ul id="filterCategoryList" class="space-y-1 max-h-64 overflow-auto pr-2">
                    <!-- search.js will populate; sample skeletons -->
                    {% for _ in range(6) %}
                    <li class="animate-pulse h-5 rounded bg-[color:var(--border)]"></li>
                    {% endfor %}
                </ul>
            </section>

            <!-- Duration -->
            <section>
                <h3 class="label">Duration</h3>
                <div class="hidden grid-cols-2 gap-2">
                    <label class="text-xs muted">Min (min)
                        <input id="durationMin" type="number" min="0" step="1" value="0" class="input w-full mt-1" />
                    </label>
                    <label class="text-xs muted">Max (min)
                        <input id="durationMax" type="number" min="0" step="1" value="0" placeholder="‚àû"
                            class="input w-full mt-1" />
                    </label>
                </div>
                <div class="chips mt-2" id="durationQuick">
                    <button class="chip" data-min="0" data-max="5">‚â§ 5m</button>
                    <button class="chip" data-min="5" data-max="20">5‚Äì20m</button>
                    <button class="chip" data-min="20" data-max="60">20‚Äì60m</button>
                    <button class="chip" data-min="60" data-max="">‚â• 60m</button>
                </div>
            </section>

            <!-- Uploaded date -->
            <section>
                <h3 class="label">Uploaded</h3>
                <div class="chips" id="dateQuick">
                    <button class="chip" data-date="24h">Last 24h</button>
                    <button class="chip" data-date="7d">7 days</button>
                    <button class="chip" data-date="30d">30 days</button>
                    <button class="chip" data-date="365d">1 year</button>
                    <button class="chip" data-date="366d">more than 1 year</button>
                </div>
                <div class="hidden grid-cols-2 gap-2 mt-2">
                    <label class="text-xs muted">From
                        <input id="dateFrom" type="date" class="input w-full mt-1" />
                    </label>
                    <label class="text-xs muted">To
                        <input id="dateTo" type="date" class="input w-full mt-1" />
                    </label>
                </div>
            </section>

            <!-- Tags -->
            <section>
                <h3 class="label">Tags</h3>
                <div id="activeTags" class="flex flex-wrap gap-2 mb-2"></div>
                <input id="tagInput" list="searchTagList" placeholder="Type and press Enter" class="input w-full" />
                <datalist id="searchTagList"></datalist>
            </section>

            <div class="hidden pt-2 gap-2">
                <button id="applyFilters" class="btn-primary flex-1">Apply</button>
                <button id="resetFilters"
                    class="btn-ghost px-3 py-2 border border-[color:var(--border)] rounded">Reset</button>
            </div>
        </div>
    </aside>

    <!-- RIGHT: SEARCH RESULTS -->
    <section class="flex-1 min-w-0">
        <section class="mb-8 text-center flex flex-col items-center">
            <h1 class="text-2xl md:text-3xl font-bold text-[color:var(--text)]">
                üîç Search Results
            </h1>
            <p class="muted mt-1">
                Showing results for: <span id="searchQuery" class="font-semibold"></span>
                <span class="ml-2">(<span id="totalResults">0</span> results)</span>
            </p>
        </section>

        <!-- Toolbar -->
        <section class="mb-6">
            <div class="glass p-3 rounded-xl flex flex-col md:flex-row md:items-center md:justify-between gap-3">
                <!-- Sort -->
                <div class="flex items-center gap-2">
                    <button data-sort="relevance"
                        class="sort-btn px-3 py-2 rounded-lg border border-[color:var(--border)] hover:bg-[color:var(--brand-50)] transition-colors">
                        ‚≠ê Relevance
                    </button>
                    <button data-sort="recent"
                        class="sort-btn px-3 py-2 rounded-lg border border-[color:var(--border)] hover:bg-[color:var(--brand-50)] transition-colors">
                        üì§ Uploaded
                    </button>
                    <button data-sort="most_viewed"
                        class="sort-btn px-3 py-2 rounded-lg border border-[color:var(--border)] hover:bg-[color:var(--brand-50)] transition-colors">
                        üëÅÔ∏è Most Viewed
                    </button>
                </div>

                <!-- View toggle -->
                <div>
                    <button id="viewToggle" class="btn-ghost px-3 py-2 rounded-lg border border-[color:var(--border)]">
                        Toggle Grid/List
                    </button>
                </div>
            </div>
        </section>

        <!-- Playlist Results -->
        <section class="mb-6">
            <div class="card p-4">
                <div class="flex items-center justify-between mb-2">
                    <h2 class="text-lg font-semibold">Playlists</h2>
                    <a href="/playlists" class="text-sm no-underline hover:underline">Browse all</a>
                </div>
                <div id="playlistResults" class="grid grid-cols-1 sm:grid-cols-2 gap-3"></div>
            </div>
        </section>

        <!-- Video Results -->
        <section>
            <div id="resultsGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-5">
                {% for _ in range(8) %}
                <article class="card p-3 animate-pulse">
                    <div class="rounded-lg h-40 bg-[color:var(--border)] mb-3"></div>
                    <div class="h-4 bg-[color:var(--border)] rounded w-4/5 mb-2"></div>
                    <div class="h-3 bg-[color:var(--border)] rounded w-3/5"></div>
                </article>
                {% endfor %}
            </div>

            <!-- Pagination -->
            <div class="mt-8 flex items-center justify-center gap-4">
                <button id="prevBtn"
                    class="btn-ghost px-4 py-2 rounded-lg border border-[color:var(--border)]">‚èÆ Prev</button>
                <span id="pageNumber" class="text-lg font-medium text-[color:var(--text)]">Page 1</span>
                <button id="nextBtn"
                    class="btn-ghost px-4 py-2 rounded-lg border border-[color:var(--border)]">Next ‚è≠</button>
            </div>
        </section>
    </section>
</main>
{% endblock %}

{% block scripts %}
<!-- Page logic -->
<script src="{{ url_for('static', filename='js/search.js') }}"></script>

<!-- Card template -->
<template id="searchCardTpl">
    <article class="card p-0 overflow-hidden hover:shadow-xl transition-shadow">
        <a class="block relative group" href="#">
            <div class="w-full aspect-video bg-[color:var(--border)] relative overflow-hidden">
                <img class="w-full h-full object-cover block" src="" alt="">
                <span class="absolute bottom-2 right-2 text-xs px-2 py-1 rounded bg-black/70 text-white">00:00</span>
                <span class="absolute top-2 left-2 badge">HD</span>
            </div>
            <div class="p-3">
                <h3 class="font-semibold line-clamp-2 text-[color:var(--text)]"></h3>
                <p class="text-sm mt-1 muted line-clamp-2"></p>
                <div class="flex items-center justify-between mt-3">
                    <div class="flex items-center gap-2">
                        <img class="w-7 h-7 rounded-full" src="" alt="">
                        <span class="text-sm muted"></span>
                    </div>
                    <span class="text-xs muted"></span>
                </div>
            </div>
        </a>
    </article>
</template>

<!-- List-row template -->
<template id="searchRowTpl">
    <a class="card p-3 flex gap-3 hover:shadow-xl transition-shadow items-center" href="#">
        <div class="w-48 shrink-0 aspect-video rounded-lg overflow-hidden bg-[color:var(--border)]">
            <img class="w-full h-full object-cover block" src="" alt="">
        </div>
        <div class="min-w-0 flex-1">
            <h3 class="font-semibold text-[color:var(--text)] line-clamp-1"></h3>
            <p class="text-sm muted mt-1 line-clamp-2"></p>
            <div class="flex items-center gap-2 mt-2">
                <img class="w-6 h-6 rounded-full" src="" alt="">
                <span class="text-xs muted"></span>
                <span class="text-xs">‚Ä¢</span>
                <span class="text-xs muted"></span>
            </div>
        </div>
        <div class="text-xs muted shrink-0 text-right">
            <div class="badge">HD</div>
            <div class="mt-1">00:00</div>
        </div>
    </a>
</template>
{% endblock %}
